---
title: "[ê°•ì˜] Node.js - 4 Day"
excerpt_separator: "<!--more-->"
categories:
  - lecture
tags:
  - Node.js
  - modern javascript
  - let
  - const
  - ECMA Script 
---

ì´ë²ˆ ìˆ˜ì—…ì— ë“¤ì€ 'ëª¨ë˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‚´í´ë³´ê¸°'ì— ëŒ€í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

ì´ëŸ° ì •ë³´ë¥¼ ì°¾ì•„ë³´ë©° ê°œë°œì„ í•œë‹¤ëŠ” ì‚¬ì‹¤ì´ ì €ì—ê² í¥ë¯¸ë¡œì› ìŠµë‹ˆë‹¤.
<!--more-->
### ëª¨ë˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‚´í´ë³´ê¸°
#### TC39
ECMA Script (= javascript) ì˜ í‘œì¤€ì„ ì¬ì • í•˜ê³  updateë¥¼ ê´€ë¦¬í•˜ëŠ” ì¡°ì§

#### node.green
Node ë²„ì „ë³„ êµ¬í˜„ëœ ê¸°ëŠ¥ì„ í™•ì¸í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€  
ìœ„ ECMA Script í‘œì¤€ ë° Update ì§„í–‰ ì¤‘ì¸ ê¸°ëŠ¥ ë“¤ì´ ì–´ë””ê¹Œì§€ êµ¬í˜„ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŒ

#### let, const - ES2015 ì˜¤í”ˆ
> hoisting ê·œì¹™ì´ ì—†ê³ , block scoping (block ë‚´ ì„ ì–¸ëœ ë³€ìˆ˜ëŠ” block ë‚´ì—ì„œë§Œ ì‚¬ìš©) ì„ ì§€ì›í•¨
- let ì€ ë ˆí¼ëŸ°ìŠ¤(ê°’ì´)ê°€ ë°”ë€” ìˆ˜ ìˆê³ , const ëŠ” ë°”ë€” ìˆ˜ ì—†ë‹¤ (= final)
- var ì™€ ë‹¬ë¦¬ let ê³¼ const ëŠ” ê°™ì€ ìŠ¤ì½”í”„ë‚´ ê°™ì€ ë³€ìˆ˜ë¥¼ ë‘ë²ˆ ì´ìƒ ì„ ì–¸í•  ìˆ˜ ì—†ë‹¤. (Syntax Error)
- let ê³¼ const ì˜ ì˜ˆì¸¡ ê°€ëŠ¥ì„±ã…‡ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì´ var ë³´ë‹¤ í›¨ì”¬ ë›°ì–´ë‚¨

> ê°€ëŠ¥í•˜ë©´ const ë§Œ ì‚¬ìš©í•˜ê³ , í•„ìš”ì‹œ let ì€ ì‚¬ìš©í•˜ë‚˜, var ëŠ” ì ˆëŒ€ ì‚¬ìš© í•˜ì§€ ë§ˆë¼

```javascript
let x = 1
x = 2 // Ok

const y = 1
y = 2 // TypeError
```
```javascript
var x = 1
var x = 2 // OK

let x = 1
let x = 2  // SyntaxError
```
```javascript
console.log(x)  // OK
var x = 0

console.log(x) // Error
const x = 0
```
```javascript
var x = 1
{
    var x = 2
    console.log(x)  // 2
}
console.log(x)  // 2

const x = 1
{
    const x = 2
    console.log(x)  // 2
}
console.log(x)  // 1
```

#### Spread Syntax - ES2015 ì˜¤í”ˆ
```javascript
// object merge (1)
const personalData = {
    nickname: 'CG',
    email: '2carrot84@gmail.com',
}

const publicData = {
    age: 22,
}

const user = {
    ...personalData,
    ...publicData,
}

console.log(user)   //  { nickname: 'CG', email: '2carrot84@gmail.com', age: 22 }
```
```javascript
// object merge (2)
const overrides = {
    DATABASE_HOST: 'myhost.com',
    DATABASE_PASSWORD: 'mypassword',
}
const config = {
    DATABASE_HOST: 'default.host.com',
    DATABASE_PASSWORD: '****',
    DATABASE_USERNAME: 'myuser',
    ...overrides
}
/*{
    DATABASE_HOST: 'myhost.com',
    DATABASE_PASSWORD: 'mypassword',
    DATABASE_USERNAME: 'myuser',
}*/
```
```javascript
// object rest
const user = {
    nickname: 'CH',
    age: 22,
    email: '2carrot84@gmail.com'
}

const { nickname, ...personalData } = user  // nickname ì œì™¸ í›„ personalData ê°ì²´ ìƒì„±
console.log(personalData)   //  { age: 22, email: '2carrot84@gmail.com' }
```
```javascript
// array merge
const pets = ['dog', 'cat']
const predators = ['wolf', 'cougar']
const animals = [...pets, ...predators]

console.log(animals)    // [ 'dog', 'cat', 'wolf', 'cougar' ]
```
```javascript
function foo(head, ...rest) {
    console.log(head)
    console.log(rest)
}
foo(1, 2, 3, 4)
/*
1
[ 2, 3, 4 ]
 */
```

### Promise
> ë¹„ë™ê¸° ì‘ì—… ì¢…ë£Œ ì‹œì ì˜ ì™„ë£Œ or ì‹¤íŒ¨ì™€ ê·¸ ê²°ê³¼ ê°’ì„ ë‚˜íƒ€ëƒ„  
> ë¯¸ë˜ì˜ ì–´ë–¤ ì‹œì ì— ê²°ê³¼ë¥¼ ì œê³µí•˜ê² ë‹¤ëŠ” ì•½ì†(Promise)ë¥¼ ë°˜í™˜

#### Promise ìƒíƒœ
- pending (ëŒ€ê¸°) : ì´í–‰í•˜ì§€ë„, ê±°ë¶€í•˜ì§€ë„ ì•Šì€ ì´ˆê¸° ìƒíƒœ
- fulfuilled (ì´í–‰) : ì—°ì‚°ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ
- reject (ê±°ì ˆ) : ì—°ì‚° ì‹¤íŒ¨

#### resolve() 
> ì£¼ì–´ì§„ ê°’ìœ¼ë¡œ ì´í–‰í•˜ëŠ” Promise ê°ì²´ë¥¼ ë°˜í™˜  
> ì§€ì •í•œ ê°’ì´ then ë©”ì„œë“œë¥¼ ê°€ì§€ëŠ” ê²½ìš°, Promise.resolve() ê°€ ë°˜í™˜í•˜ëŠ” PromiseëŠ” then ë©”ì„œë“œë¥¼ ë”°ë¼ê°€ì„œ ìì‹ ì˜ ìµœì¢… ìƒíƒœë¥¼ ê²°ì •

#### reject(reason)
> ì£¼ì–´ì§„ ì‚¬ìœ ë¡œ ê±°ë¶€í•˜ëŠ” Promise ê°ì²´ë¥¼ ë°˜í™˜

#### then
> Promise ì— ì´í–‰ê³¼ ê±°ë¶€ì²˜ë¦¬ê¸° ì½œë°±ì„ ì¶”ê°€
#### catch
> Promise ì— ê±°ë¶€ì²˜ë¦¬ê¸°ì— ì½œë°±ì„ ì¶”ê°€
#### finally
> Promise ì— ì´í–‰, ê±°ë¶€ì— ìƒê´€ ì—†ì´ í•­ìƒ í˜¸ì¶œ

```javascript
const sleep = (ms) => {
    return new Promise(resolve => {
        setTimeout(resolve, ms)
    })
}

new Promise((resolve, rejects) => {
    console.log('Inside promise')
    sleep(1000)
    rejects(new Error('First reject'))
    resolve('First resolve')
}).then(value => {
    console.log('Inside first then')
    console.log('value', value)
}).catch(error => {
    console.log('error', error)
})
/*
Inside promise
error
:Error: First reject
 */

new Promise((resolve, rejects) => {
    console.log('Inside promise')
    rejects(new Error('First reject'))
    resolve('First resolve')
}).catch(error => {
    console.log('error', error)
}).then(value => {
    console.log('Inside first then')
    console.log('value ', value)
})
/*
Inside promise
error
:Error: First reject
Inside first then
value undefined
 */

new Promise((resolve, rejects) => {
    console.log('Inside promise')
    setTimeout(() => {
        resolve(Math.random())
        console.log('After resolve')
    }, 1000)
}).then((value) => {
    console.log('then 1')
    console.log('value :', value)
}).then((value) => {
    console.log('then 2')
}).then((value) => {
    console.log('then 3')
})
/*
Inside promise
After resolve
then 1
value0.6893501856716817
then 2
then 3
 */
```
```javascript
function returnPromiseForTimeout() {
    return new Promise((resolve) => {
        setTimeout(() => {
            resolve(Math.random())
        }, 1000)
    })
}

returnPromiseForTimeout()
    .then(value => {
        console.log(value)
        return returnPromiseForTimeout()
    })
    .then(value => {
        console.log(value)
        return returnPromiseForTimeout()
    })
    .then(value => {
        console.log(value)
        return returnPromiseForTimeout()
    })
    .then(value => {
        console.log(value)
        return returnPromiseForTimeout()
    })
/*
0.8451924276841662
0.3173270175130023
0.2899827674825355
0.8148152584175137
 */

setTimeout(() => {
    const value1 = Math.random()
    console.log(value1)
    setTimeout(() => {
        const value2 = Math.random()
        console.log(value2)
        setTimeout(() => {
            const value3 = Math.random()
            console.log(value3)
            setTimeout(() => {
                const value4 = Math.random()
                console.log(value4)
            }, 1000)
        }, 1000)
    }, 1000)
}, 1000)

/*
0.8581614552504644
0.3946617212828898
0.8469318628343485
0.7590294478424375
 */
```
```javascript
const fs = require('fs')
async function main() {
    try {
        const result = await fs.promises.readFile('../.gitignore', 'utf-8')
        console.log(result)
    } catch (e) {
        console.log('error', e)
    }
}
main()

function readFileInPromise(filename) {
    return new Promise((resolve, reject) => {
        fs.readFile(filename, 'utf-8', (error, value) => {
            if (error) {
                reject(error)
            }
            resolve(value)
        })
    })
}

readFileInPromise('.gitignore').then(value => console.log(value))

fs.readFile('.gitignore', 'utf-8', (error, value) => {
    console.log(value)
})
fs.promises.readFile('../.gitignore', 'utf-8')
    .then(value => console.log(value))
```

### async / await
#### async
> ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ async í•¨ìˆ˜ë¡œ ë§Œë“¤ê¸° ìœ„í•˜ì—¬ function() ì•ì— async í‚¤ì›Œë“œ ì¶”ê°€    
> async í•¨ìˆ˜ëŠ” await í‚¤ì›Œë“œê°€ ë¹„ë™ê¸°ã…£ ì½”ë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í•¨ìˆ˜  
> async í‚¤ì›Œë“œ ì¶”ê°€ ì‹œ í•¨ìˆ˜ëŠ” ê²°ê³¼ ëŒ€ì‹  Promise ë¥¼ ë°˜í™˜

#### await
> await + async í•¨ìˆ˜ ì‚¬ìš©ì‹œ ì¥ì ì´ í™•ì‹¤  
> Promise ê¸°ë°˜ í•¨ìˆ˜ ì•ì— ë†“ì„ ìˆ˜ ìˆìŒ
- Promise ê°€ fulfil ë ë•Œê¹Œì§€ ì ì‹œ ì¤‘ë‹¨í•˜ê³  ê²°ê³¼ë¥¼ ë°˜í™˜
- ì‹¤í–‰ì„ ê¸°ë‹¤ë¦¬ëŠ” ë‹¤ë¥¸ ì½”ë“œë“¤ì„ ì¤‘ì§€ ì—†ì´ ì‹¤í–‰

```javascript
async function sleep(duration) {
    return new Promise((resolve) => {
        setTimeout(() => {
            resolve(undefined)
        }, duration)
    })
}

async function main() {
    console.log('first')
    await sleep(1000)
    console.log('second')
    await sleep(1000)
    console.log('third')
    await sleep(1000)
    console.log('finish!')
}

main()
/*
first
second
third
finish!
 */
```

### ë§ˆë¬´ë¦¬
ê¸°ë¡ì„ í•˜ê³  ìˆì§€ë§Œ ëŒì•„ì„œë©´ ê¹Œë¨¹ëŠ”ê±´ ì§‘ì¤‘ì„ ëª»í•œ íƒ“ì¼ê¹Œ.. ë‚˜ì´ íƒ“ì¼ê¹Œ.. ğŸ¤”ğŸ˜‚

ê·¸ëŸ¼ ì´ë§Œ. ğŸ¥•ğŸ‘‹ğŸ¼ğŸ–ğŸ¼