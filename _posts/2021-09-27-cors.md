---
title: "CORS"
excerpt_separator: "<!--more-->"
categories:
  - development
tags:
  - web
  - http
date: 2021-09-27T23:00
---

ì‹ ê·œ ì…ì‚¬í•œ íšŒì‚¬ ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì†ŒìŠ¤ë¥¼ ë³´ë‹¤ CorsRegistryë¥¼ í†µí•´ì„œ CORS ì„¤ì •í•˜ëŠ” ì†ŒìŠ¤ë¥¼ ë³´ê³  CORSì— ëŒ€í•´ ìì„¸íˆ ëª¨ë¥´ëŠ”ê±° ê°™ì•„ì„œ ì˜¤ì „ë‚´ë‚´ ì½ì–´ë³¸ ë‚´ìš©ì„ í¬ìŠ¤íŒ…ìœ¼ë¡œ ì˜®ê²¨ ë´…ë‹ˆë‹¤.

<!--more-->

### CORS (Cross-Origin Resource sharing)
> ì¶”ê°€ HTTP í—¤ë”ë¥¼ ì‚¬ìš©í•˜ì—¬, í•œ `ì¶œì²˜(ë„ë©”ì¸, í”„ë¡œí† ì½œ, í¬íŠ¸)`ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ `ë‹¤ë¥¸ ì¶œì²˜ì˜ ì„ íƒí•œ ìì›ì— ì ‘ê·¼`í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ë„ë¡ ë¸Œë¼ìš°ì €ì— ì•Œë ¤ì£¼ëŠ” ì²´ì œ

A ë„ë©”ì¸ script ë“±ì—ì„œ B ë„ë©”ì¸ì„ í˜¸ì¶œ ì‹œ B ë„ë©”ì¸ì—ì„œ ì´ ì ‘ê·¼ì„ í—ˆìš©í• ì§€ ì—¬ë¶€ë¥¼ `Access-Control-Allow-Origin` í—¤ë”ì— ë‹¤ì‹œ ë³´ë‚¸ë‹¤.
> cross-site ë°©ì‹ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ í—ˆìš© ì—¬ë¶€ë¥¼ ì„¤ì •

HTTP ìš”ì²­ì„ ì•„ë˜ì™€ ê°™ì´ 2ê°€ì§€ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆë‹¤.
1. simple requests
2. preflighted requests

2ê°€ì§€ì— ëŒ€í•´ ìƒì„¸í•˜ê²Œ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

---
### simple requests (ë‹¨ìˆœ ìš”ì²­)
CORS preflightë¥¼ íŠ¸ë¦¬ê±° í•˜ì§€ ì•ŠëŠ” ìš”ì²­ì„ ë¬¶ì–´ì„œ simple requests ë¼ê³  ì¼ì»«ìœ¼ë©°, ì•„ë˜ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•˜ëŠ” ìš”ì²­ì´ ì´ì— í•´ë‹¹í•œë‹¤.

> 1. GET, POST, HEAD ë©”ì†Œë“œ ì¤‘ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¥¼ ì‚¬ìš©
> 1. ìœ ì € ì—ì´ì „íŠ¸ê°€ ìë™ìœ¼ë¡œ ì„¤ì •í•œ í—¤ë” ì™¸ì— ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆëŠ” ì¼ë¶€ í—¤ë”ë§Œ í¬í•¨ëœ ìš”ì²­
>   - ìˆ˜ë™ ì„¤ì • ê°€ëŠ¥í•œ í—¤ë” ëª©ë¡  
> Accept  
> Accept-Language  
> Content-Language  
> Content-Type
> 1. Context-Type í—¤ë” ê°’ì´ ì•„ë˜ì¸ ê²½ìš°
>   - application/x-www-form-urlencoded
>   - multipart/form-data
>   - text/plain 
> 1. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ë“±ë¡ë˜ì§€ ì•Šì€ XMLHttpRequestUpload ê°ì²´ë¥¼ ì‚¬ìš©í•œ ìš”ì²­
>   - ì´ë“¤ì€ [XMLHttpRequest.upload](https://developer.mozilla.org/ko/docs/Web/API/XMLHttpRequest/upload) í”„ëŸ¬í¼í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì ‘ê·¼ - ë¬´ìŠ¨ ë§ì¸ì§€..ğŸ¤¬
> 1. [ReadbleStreme](https://developer.mozilla.org/ko/docs/Web/API/ReadableStream) ê°ì²´ê°€ ì‚¬ìš©ë˜ì§€ ì•Šì€ ìš”ì²­
   
### preflighted request
**`OPTIONS ë©”ì†Œë“œ`**ë¥¼ í†µí•´ ë‹¤ë¥¸ ë„ë©”ì¸(ë‹¤ë¥¸ ì¶œì²˜) ë¦¬ì†ŒìŠ¤ë¡œ HTTP ìš”ì²­ì„ ë³´ë‚´, ì‹¤ì œ ìš”ì²­(request)ì´ ì „ì†¡í•˜ê¸° ì•ˆì „í•œì§€ í™•ì¸
> cross-site(ë‹¤ë¥¸ ë„ë©”ì¸)ê°„ í†µì‹ ì„ ìœ„í•œ ì¼ì¢…ì˜ [handshaking](https://ko.wikipedia.org/wiki/%ED%95%B8%EB%93%9C%EC%85%B0%EC%9D%B4%ED%82%B9) ì •ë„ë¼ê³  ì´í•´ í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ ì‹¶ìŠµë‹ˆë‹¤.

![preflight request](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/preflight_correct.png)

ì²« ë²ˆì§¸ í†µì‹ ì€ preflight request/responseì…ë‹ˆë‹¤.

> OPTIONS /resources/post-here/ HTTP/1.1
Host: bar.other
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Connection: keep-alive
Origin: http://foo.example
Access-Control-Request-Method: POST
Access-Control-Request-Headers: X-PINGOTHER, Content-Type
>
> HTTP/1.1 204 No Content
Date: Mon, 01 Dec 2008 01:15:39 GMT
Server: Apache/2
Access-Control-Allow-Origin: https://foo.example
Access-Control-Allow-Methods: POST, GET, OPTIONS
Access-Control-Allow-Headers: X-PINGOTHER, Content-Type
Access-Control-Max-Age: 86400
Vary: Accept-Encoding, Origin
Keep-Alive: timeout=2, max=100
Connection: Keep-Alive

preflight requestê°€ ì™„ë£Œë˜ë©´ ì‹¤ì œ ìš”ì²­ì„ ì „ì†¡í•©ë‹ˆë‹¤.

> POST /resources/post-here/ HTTP/1.1
Host: bar.other
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:71.0) Gecko/20100101 Firefox/71.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,decflate
Connection: keep-alive
X-PINGOTHER: pingpong
Content-Type: text/xml; charset=UTF-8
Referer: https://foo.example/examples/preflightInvocation.html
Content-Length: 55
Origin: https://foo.example
Pragma: no-cache
Cache-Control: no-cache  
<person><name>Arun</name></person>
>
> HTTP/1.1 200 OK
Date: Mon, 01 Dec 2008 01:15:40 GMT
Server: Apache/2
Access-Control-Allow-Origin: https://foo.example
Vary: Accept-Encoding, Origin
Content-Encoding: gzip
Content-Length: 235
Keep-Alive: timeout=2, max=99
Connection: Keep-Alive
Content-Type: text/plain  
> [Some GZIP'd payload]


ì‹¤ì œ Request ì—ì„œ ë³´ë‚¼ í•­ëª©ì„ `Access-Control-Request-* í—¤ë”ì— í¬í•¨`í•˜ì—¬ ì „ì†¡í•˜ë©°, ì‹¤ì œ Request ì—ì„  `Access-Control-Request-* í—¤ë”`ëŠ” í¬í•¨í•˜ì§€ ì•Šê³  ì „ì†¡í•œë‹¤.

### ì¸ì¦ì •ë³´ë¥¼ í¬í•¨í•œ ìš”ì²­
credentialed request ëŠ” HTTP Cookie ì™€ HTTP Authentication ì •ë³´(= ì¸ì¦ì •ë³´)ë¥¼ ì¸ì‹í•œë‹¤. 

ê¸°ë³¸ì ìœ¼ë¡œ cross-site XMLHttpRequest ë‚˜ Fetch í˜¸ì¶œì—ì„œ ë¸Œë¼ìš°ì €ëŠ” ìê²© ì¦ëª…(= ì¸ì¦ì •ë³´)ì„ ë³´ë‚´ì§€ ì•ŠìŠµë‹ˆë‹¤. XMLHttpRequest ê°ì²´ë‚˜ Request ìƒì„±ìê°€ í˜¸ì¶œë  ë•Œ íŠ¹ì • í”Œë˜ê·¸(withCredentials)ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

> simple GET request ëŠ” preflighted ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¼ë°˜ì ì¸ cross-site ìš”ì²­ì‹œ ì¸ì¦ì •ë³´ê°€ í¬í•¨ë˜ëŠ” ê²½ìš° Access-Control-Allow-Credentials: true í—¤ë”ê°€ ì—†ëŠ” ì‘ë‹µì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ê²½ìš° ë¸Œë¼ìš°ì €ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì›¹ ì»¨í…ì¸  ì‘ë‹µ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤.  
 
> CORS ìš”ì²­ì˜ ê²½ìš°, ë¸Œë¼ìš°ì €ê°€ í”„ëŸ°íŠ¸ì—”ë“œ JavaScript ì½”ë“œì— ëŒ€í•œ ì‘ë‹µì„ ë…¸ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” ì„œë²„([Access-Control-Allow-Credentials](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Access-Control-Request-Headers) í—¤ë” ì‚¬ìš©)ì™€ í´ë¼ì´ì–¸íŠ¸(XHR, Fetch ë˜ëŠ” Ajax ìš”ì²­ì— ëŒ€í•œ ìê²© ì¦ëª… ëª¨ë“œë¥¼ ì„¤ì •í•˜ì—¬)ê°€ ìê²© ì¦ëª… í¬í•¨ì„ ì„ íƒí•˜ê³  ìˆìŒì„ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤.

### HTTP ì‘ë‹µ í—¤ë”

Access-Control-Allow-Origin
> ë‹¨ì¼ ì¶œì²˜ë¥¼ ì§€ì •í•˜ì—¬ ë¸Œë¼ìš°ì €ê°€ í•´ë‹¹ ì¶œì²˜ê°€ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ í—ˆìš©í•¨  
> ìê²© ì¦ëª…ì´ ì—†ëŠ” ìš”ì²­ì˜ ê²½ìš° ì™€ì¼ë“œ ì¹´ë“œ(*)ëŠ” ë¸Œë¼ìš°ì € origin ì— ìƒê´€ì—†ì´ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ì„ í—ˆìš©í•¨  
> ì¦‰, ì„œë²„ ì…ì¥ì—ì„œ ì ‘ê·¼ì„ í—ˆìš©í•  cross-site ë¥¼ ì„¤ì •í•˜ëŠ” ìš©ë„ 

Access-Control-Expose-Headers
> ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í—¤ë”ë¥¼ ì„œë²„ì˜ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€

Access-Control-Max-Age
> preflight request ìºì‹± ì£¼ê¸°(ë‹¨ìœ„ : ì´ˆ)
> í•´ë‹¹ í—¤ë”ê°’ ë§Œí¼ ìƒˆë¡œìš´ preflight request ë¥¼ ë³´ë‚´ì§€ ì•Šê³ , ê¸°ì¡´ì— ë°›ì€ ì‘ë‹µê°’ì„ ì‚¬ìš©

Access-Control-Allow-Credentials - ê°€ì¥ ì´í•´ í•˜ê¸° ì–´ë ¤ìš´ í•­ëª©..ğŸ˜…
> í—¤ë”ëŠ” credentials í”Œë˜ê·¸ê°€ true ì¼ë•Œ, ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ í‘œì‹œí™œ ìˆ˜ ìˆëŠ”ì§€ ë‚˜íƒ€ëƒ„  
> preflight request ì— ëŒ€í•œ ì‘ë‹µì˜ ì¼ë¶€ë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, credentials ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ìš”ì²­ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ”ì§€ ë‚˜íƒ€ëƒ„  
> simple get request(ë‹¨ìˆœ ìš”ì²­) ëŠ” preflighted ë˜ì§€ ì•ŠìŒìœ¼ë¡œ, `credentials ê°€ ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•˜ë©´ ì´ í—¤ë”ê°€ ë¦¬ì†ŒìŠ¤ë¥¼ ë°˜í™˜í•˜ì§€ ì•ŠëŠ”ë‹¤.`

Access-Control-Allow-Methods
> ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í• ë•Œ í—ˆìš©ë˜ëŠ” ë©”ì†Œë“œë¥¼ ì§€ì •

Access-Control-Allow-Headers
> preflight request ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ í•´ë‹¹ í—¤ë” ì‚¬ìš©
> ì‹¤ì œ ìš”ì²­ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í—¤ë”ë“¤ì„ ë‚˜íƒœëƒ„

### HTTP ìš”ì²­ í—¤ë”
Cross-Origin ë¦¬ì†ŒìŠ¤ ê³µìœ  ëª…ì„¸ì— ì •ì˜ëœ ëŒ€ë¡œ ì„œë²„ê°€ ì ‘ê·¼ ì œì–´ ìš”ì²­ì„ ìœ„í•´ ë³´ë‚´ëŠ” HTTP ì‘ë‹µ í—¤ë”ê°€ ë‚˜ì—´

Origin : cross-site ì ‘ê·¼ ìš”ì²­ or preflight request ì¶œì²˜
> ìš”ì²­ì´ ì‹œì‘ëœ ì„œë²„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” `URI`(ìƒì„¸ path ëŠ” ì œì™¸ë¨)  

Access-Control-Request-Method
> ì‹¤ì œ ìš”ì²­ì‹œ ì–´ë–¤ HTTP ë©”ì†Œë“œë¥¼ ì‚¬ìš©í• ì§€ ì„œë²„ì—ê²Œ ì•Œë ¤ì£¼ê¸° ìœ„í•´ preflight request ì—ì„œ ì‚¬ìš©

Access-Control-Request-Headers
> ì‹¤ì œ ìš”ì²­ì‹œ ì–´ë–¤ HTTP í—¤ë”ë¥¼ ì‚¬ìš©í• ì§€ ì„œë²„ì—ê²Œ ì•Œë ¤ì£¼ê¸° ìœ„í•´ preflight request ì—ì„œ ì‚¬ìš©

### ë§ˆë¬´ë¦¬
ì§€ê¸ˆ ë¶€í„° ì—…ë¬´ê°„ ë§ì´í•˜ëŠ” ê°œë…ì´ë‚˜ í•­ëª©? ì— ëŒ€í•´ ê¹Šì´ ìˆê²Œ ì´í•´ë¥¼ í•´ë³´ìëŠ” ì·¨ì§€ë¡œ ì˜¤ëŠ˜ í¬ìŠ¤íŒ…ì„ ì‘ì„±í•´ ë³´ì•˜ì§€ë§Œ ì–¼ë§ˆë‚˜ ì§€ì†í•  ìˆ˜ ìˆì„ì§€ ìŠ¤ìŠ¤ë¡œ ì˜ë¬¸ì„ í’ˆì€ì±„ë¡œ..

ê·¸ëŸ¼ ì´ë§Œ. ğŸ¥•ğŸ‘‹ğŸ¼ğŸ–ğŸ¼

### ì°¸ê³ ìë£Œ
[https://developer.mozilla.org/ko/docs/Web/HTTP/CORS](https://developer.mozilla.org/ko/docs/Web/HTTP/CORS)